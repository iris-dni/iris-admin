/* eslint-disable react/no-multi-comp */
import * as React from 'react';
import { assert } from 'chai';
import { mount } from 'enzyme';

import ItemsControl from '../';

const items = [
  { id: 'id-0', title: 'Title 0', valid: true },
  { id: 'id-1', title: 'Title 1', valid: false },
  { id: 'id-2', title: 'Title 2', valid: false }
];


describe('<ItemsControl />', () => {
  it('by default uses <div /> as wrapping element', () => {
    const ItemsTemplate = () => <span />;
    const wrapper = mount(
      <ItemsControl
        items={items}
        itemsTemplate={ItemsTemplate}
        uniqueItemProperty="id"
      />
    );
    assert.isTrue(wrapper.html().startsWith('<div'));
  });

  it('if specified uses <tbody /> as wrapping element', () => {
    const ItemsTemplate = () => <tr />;
    const wrapper = mount(
      <table>
        <ItemsControl
          items={items}
          itemsTemplate={ItemsTemplate}
          uniqueItemProperty="id"
          wrapperElement="tbody"
        />
      </table>
    );
    assert.isTrue(wrapper.children().first().html().startsWith('<tbody'));
  });

  it('renders each item using the provided ItemsTemplate', () => {
    const ItemsTemplate = (p) => <span>{p.item.title}</span>;
    const wrapper = mount(
      <ItemsControl
        items={items}
        itemsTemplate={ItemsTemplate}
        uniqueItemProperty="id"
      />
    );
    assert.equal(wrapper.find(ItemsTemplate).length, items.length);
    items.forEach((item, index) => {
      assert.equal(wrapper.find(ItemsTemplate).at(index).text(), item.title);
    });
  });
});
