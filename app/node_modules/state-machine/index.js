const api = () => window.__swaggerClient.apis.statemachine;

const UNKNOWN_ERROR = { error: 'UNKNOWN' };

const cache = {};

export default {
  /**
   * Gets a state machine representation from the backend.
   */
  get(name) {
    return new Promise((resolve, reject) => {
      if (cache[name]) {
        resolve(cache[name]);
      } else {
        api().statemachine({ name: name }).then(response => {
          if (response && response.obj) {
            resolve(response.obj.data);
          } else {
            reject(UNKNOWN_ERROR);
          }
        }).catch(response => {
          if (response && response.obj) {
            reject(response.obj);
          } else {
            reject(UNKNOWN_ERROR);
          }
        });
      }
    }).then(sm => cache[name] = sm);
  },
};
