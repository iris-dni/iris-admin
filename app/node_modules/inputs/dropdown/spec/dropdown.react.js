import * as React from 'react';
import { assert } from 'chai';
import { mount } from 'enzyme';

import Dropdown from '../';


const makeDropdown = (id, name, onValueChange, options = []) => mount(
  <Dropdown
    id={id}
    name={name}
    options={options}
    onValueChange={onValueChange}
  />
);

const simulateSelectChange = (wrapper, newValue) => {
  wrapper.find('select').get(0).value = newValue;
  wrapper.find('select').first().simulate('change');
};

describe('<Dropdown />', () => {
  it('renders a <select /> element', () => {
    const wrapper = makeDropdown('id', 'name', () => {});
    const selects = wrapper.find('select');
    assert.equal(selects.length, 1);
  });

  it('calls onValueChange when select value changes', (done) => {
    const wrapper = makeDropdown('id', 'name', () => { done(); });
    simulateSelectChange(wrapper, 'hi');
  });

  it('calls onValueChange with name, new value, and isValid', (done) => {
    const handleValueChange = (name, value, isValid) => {
      assert.equal(name, 'input-name');
      assert.equal(value, '_1');
      assert.isTrue(isValid);
      done();
    };
    const wrapper = makeDropdown('id', 'input-name', handleValueChange, [
      { value: '', label: 'default' },
      { value: '_1', label: 'value-1' }
    ]);
    simulateSelectChange(wrapper, '_1');
  });
});
